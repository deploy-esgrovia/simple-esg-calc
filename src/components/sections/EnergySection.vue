<script setup>
import { ref, watch } from 'vue';
import InputWithUnit from '../InputWithUnit.vue';
import TypeSelector from '../TypeSelector.vue';

const props = defineProps({
	modelValue: Object,
});

const emit = defineEmits(['update:modelValue']);

// Data
const annualConsumption = ref(props.modelValue.annualConsumption || '');
const selectedEnergyType = ref(props.modelValue.selectedEnergyType || 'regular');
const sourceTypeValues = ref(props.modelValue.sourceTypeValues || {
	photovoltaic: '',
	biomass: '',
	wind: '',
	water: '',
	nuclear: '',
});

// Constants
const sourceTypeLabels = {
	photovoltaic: "Fotovoltaika",
	biomass: "Biomasa / bioplyn",
	wind: "Vítr",
	water: "Voda",
	nuclear: "Jádro",
};

const energyTypes = [
	{
		id: "regular",
		label: "Běžná elektřina",
		icon: "🔌",
	},
	{
		id: "green",
		label: "Zelený tarif",
		icon: "🌿",
	},
	{
		id: "guaranteed",
		label: "Záruky původu",
		icon: "🤝",
	},
];

// Watch
watch(
	[annualConsumption, selectedEnergyType, sourceTypeValues],
	() => {
		const updatedModelValue = {
			annualConsumption: annualConsumption.value,
			selectedEnergyType: selectedEnergyType.value,
		};

		if (selectedEnergyType.value === 'guaranteed') {
			// Include `sourceTypeValues` only when the selected type is 'guaranteed'
			updatedModelValue.sourceTypeValues = sourceTypeValues.value;
		}

		// Emit the updated modelValue
		emit('update:modelValue', updatedModelValue);
	},
	{ deep: true }
);
</script>

<template>
	<div class="max-w-4xl mx-auto p-8">
		<h2 class="text-2xl text-gray-900 mb-4">Nakupovaná elektrická energie</h2>
		<p class="text-gray-600 mb-8">
			Zadejte roční spotřebu a původ elektřiny. Pokud ji neznáte, podívejte se do posledního
			vyúčtování.
		</p>

		<div class="mb-8">
			<InputWithUnit
				label="Kolik elektřiny nakupujete?"
				v-model="annualConsumption"
				unit="MWh / rok"
				:error="annualConsumption === ''"
			/>
		</div>

		<div class="mb-8">
			<h3 class="text-lg font-semibold">Jakou elektřinu odebíráte?</h3>
			<TypeSelector v-model="selectedEnergyType" :energyTypes="energyTypes" />
		</div>

		<div v-if="selectedEnergyType === 'guaranteed'" class="mb-8">
			<div v-for="(label, source) in sourceTypeLabels" :key="source" class="mb-4">
				<InputWithUnit :label="label" v-model="sourceTypeValues[source]" unit="MWh / rok" />
			</div>
		</div>
	</div>
</template>
